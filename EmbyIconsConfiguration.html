<div is="emby-scroller" class="view flex flex-direction-column scrollFrameY flex-grow" data-horizontal="false" data-forcescrollbar="true" data-centerfocus="true" data-bindheader="true" data-controller="__plugin/EmbyIconsConfigurationjs" data-title="EmbyIcons">

    <div class="scrollSlider flex-grow flex-direction-column padded-left padded-left-page padded-right padded-top-page padded-bottom-page">
        <div class="readOnlyContent auto-center">

            <div data-role="controlgroup" data-type="horizontal" class="localnav">
                <a is="emby-linkbutton" class="nav-settings ui-btn-active" href="#" data-role="button">Settings</a>
                <a is="emby-linkbutton" class="nav-readme" href="#" data-role="button">Readme</a>
            </div>

            <div id="settingsPage" style="margin-top: 2em;">
                <form class="embyIconsForm">
                    <div class="flex align-items-center" style="margin: 2em 0 .5em;">
                        <h2 style="margin: 0;">General Settings</h2>
                    </div>
                    <div class="inputContainer">
                        <div style="display: flex; align-items: flex-end;">
                            <div style="flex-grow: 1;">
                                <input is="emby-input" type="text" id="txtIconsFolder" label="Icons Folder:" autocomplete="off" data-config-key="IconsFolder" />
                            </div>
                            <button type="button" is="emby-button" class="raised" id="btnSelectIconsFolder" title="Browse for folder" style="margin-left: 1em;">
                                <span>...</span>
                            </button>
                        </div>
                        <div id="iconsFolderWarning" class="fieldDescription" style="color: #ffc107; display: none; margin-top: .5em;"></div>
                        <div class="fieldDescription">The full path to the folder where your custom icons are stored.</div>
                    </div>

                    <div class="flex align-items-center" style="margin: 2em 0 .5em;">
                        <h3 style="margin: 0;">Cache Management</h3>
                    </div>
                    <div class="fieldDescription" style="margin-bottom: 1em;">
                        If you have added, removed, or changed any icon files, clear the cache to apply the changes.
                        Your posters will be updated with the new icons as you browse your libraries.
                    </div>
                    <div>
                        <button is="emby-button" type="button" class="raised button-cancel" id="btnClearCache">
                            <span>Clear Icon Cache</span>
                        </button>
                    </div>

                    <div class="inputContainer" style="margin-top: 2.5em;">
                        <h3 style="margin-bottom: 0.5em;">Apply to these libraries</h3>
                        <div id="librarySelectionContainer" class="paper-card" style="padding: 1em 1.5em; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 0.5em 1.5em;">
                        </div>
                        <div class="fieldDescription" style="margin-top: 0.5em;">Leave all unchecked to apply to all libraries.</div>
                        <input type="hidden" id="txtSelectedLibraries" data-config-key="SelectedLibraries" />
                    </div>

                    <div class="flex align-items-center" style="margin: 3em 0 .5em;">
                        <h2 style="margin: 0;">Overlay Toggles</h2>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1em 2em;">
                        <div class="checkboxContainer"><label><input is="emby-checkbox" type="checkbox" id="chkShowAudioIcons" data-config-key="ShowAudioIcons" /><span>Show Audio Language Icons</span></label></div>
                        <div class="checkboxContainer"><label><input is="emby-checkbox" type="checkbox" id="chkShowSubtitleIcons" data-config-key="ShowSubtitleIcons" /><span>Show Subtitle Language Icons</span></label></div>
                        <div class="checkboxContainer"><label><input is="emby-checkbox" type="checkbox" id="chkShowAudioChannelIcons" data-config-key="ShowAudioChannelIcons" /><span>Show Audio Channel Icons (e.g., 7.1)</span></label></div>
                        <div class="checkboxContainer"><label><input is="emby-checkbox" type="checkbox" id="chkShowAudioCodecIcons" data-config-key="ShowAudioCodecIcons" /><span>Show Audio Codec Icons (e.g., DTS)</span></label></div>
                        <div class="checkboxContainer"><label><input is="emby-checkbox" type="checkbox" id="chkShowVideoFormatIcons" data-config-key="ShowVideoFormatIcons" /><span>Show Video Format Icons (e.g., HDR)</span></label></div>
                        <div class="checkboxContainer"><label><input is="emby-checkbox" type="checkbox" id="chkShowVideoCodecIcons" data-config-key="ShowVideoCodecIcons" /><span>Show Video Codec Icons (e.g., H265)</span></label></div>
                        <div class="checkboxContainer"><label><input is="emby-checkbox" type="checkbox" id="chkShowTagIcons" data-config-key="ShowTagIcons" /><span>Show Custom Tag Icons</span></label></div>
                        <div class="checkboxContainer"><label><input is="emby-checkbox" type="checkbox" id="chkShowResolutionIcons" data-config-key="ShowResolutionIcons" /><span>Show Resolution Icons (e.g., 4K)</span></label></div>
                        <div class="checkboxContainer"><label><input is="emby-checkbox" type="checkbox" id="chkShowCommunityScoreIcon" data-config-key="ShowCommunityScoreIcon" /><span>Show Community Rating Icon</span></label></div>
                        <div class="checkboxContainer"><label><input is="emby-checkbox" type="checkbox" id="chkShowAspectRatioIcons" data-config-key="ShowAspectRatioIcons" /><span>Show Aspect Ratio Icons (e.g., 16:9)</span></label></div>
                    </div>

                    <div class="flex align-items-center" style="margin: 3em 0 .5em;">
                        <h2 style="margin: 0;">TV Show Settings</h2>
                    </div>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label><input is="emby-checkbox" type="checkbox" id="chkShowOverlaysForEpisodes" data-config-key="ShowOverlaysForEpisodes" /><span>Show overlays on episode images</span></label>
                        <div class="fieldDescription checkboxFieldDescription">When disabled, overlays will only appear on movies, series, and seasons.</div>
                    </div>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label><input is="emby-checkbox" type="checkbox" id="chkShowSeriesIconsIfAllEpisodesHaveLanguage" data-config-key="ShowSeriesIconsIfAllEpisodesHaveLanguage" /><span>Show icons on series/seasons</span></label>
                        <div class="fieldDescription checkboxFieldDescription">Icons will only appear on a series/season poster if all child episodes share the same property.</div>
                    </div>
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label><input is="emby-checkbox" type="checkbox" id="chkUseSeriesLiteMode" data-config-key="UseSeriesLiteMode" /><span>Use Lite Mode for series scans</span></label>
                        <div class="fieldDescription checkboxFieldDescription">Faster, but less accurate. Only checks the first episode to determine icons for the entire series.</div>
                    </div>

                    <div class="flex align-items-center" style="margin: 3em 0 .5em;">
                        <h2 style="margin: 0;">Alignment & Layout</h2>
                    </div>
                    <div class="paper-card" style="padding: 1.5em;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2em 2.5em;">
                            <div>
                                <select is="emby-select" id="selAudioIconAlignment" label="Audio Icon Alignment" data-config-key="AudioIconAlignment"><option value="TopLeft">Top Left</option><option value="TopRight">Top Right</option><option value="BottomLeft">Bottom Left</option><option value="BottomRight">Bottom Right</option></select>
                                <div class="checkboxContainer" style="margin-top: 1.5em;"><label><input is="emby-checkbox" type="checkbox" id="chkAudioOverlayHorizontal" data-config-key="AudioOverlayHorizontal" /><span>Layout Horizontally</span></label></div>
                            </div>
                            <div>
                                <select is="emby-select" id="selSubtitleIconAlignment" label="Subtitle Icon Alignment" data-config-key="SubtitleIconAlignment"><option value="TopLeft">Top Left</option><option value="TopRight">Top Right</option><option value="BottomLeft">Bottom Left</option><option value="BottomRight">Bottom Right</option></select>
                                <div class="checkboxContainer" style="margin-top: 1.5em;"><label><input is="emby-checkbox" type="checkbox" id="chkSubtitleOverlayHorizontal" data-config-key="SubtitleOverlayHorizontal" /><span>Layout Horizontally</span></label></div>
                            </div>
                            <div>
                                <select is="emby-select" id="selChannelIconAlignment" label="Channel Icon Alignment" data-config-key="ChannelIconAlignment"><option value="TopLeft">Top Left</option><option value="TopRight">Top Right</option><option value="BottomLeft">Bottom Left</option><option value="BottomRight">Bottom Right</option></select>
                                <div class="checkboxContainer" style="margin-top: 1.5em;"><label><input is="emby-checkbox" type="checkbox" id="chkChannelOverlayHorizontal" data-config-key="ChannelOverlayHorizontal" /><span>Layout Horizontally</span></label></div>
                            </div>
                            <div>
                                <select is="emby-select" id="selAudioCodecIconAlignment" label="Audio Codec Icon Alignment" data-config-key="AudioCodecIconAlignment"><option value="TopLeft">Top Left</option><option value="TopRight">Top Right</option><option value="BottomLeft">Bottom Left</option><option value="BottomRight">Bottom Right</option></select>
                                <div class="checkboxContainer" style="margin-top: 1.5em;"><label><input is="emby-checkbox" type="checkbox" id="chkAudioCodecOverlayHorizontal" data-config-key="AudioCodecOverlayHorizontal" /><span>Layout Horizontally</span></label></div>
                            </div>
                            <div>
                                <select is="emby-select" id="selVideoFormatIconAlignment" label="Video Format Icon Alignment" data-config-key="VideoFormatIconAlignment"><option value="TopLeft">Top Left</option><option value="TopRight">Top Right</option><option value="BottomLeft">Bottom Left</option><option value="BottomRight">Bottom Right</option></select>
                                <div class="checkboxContainer" style="margin-top: 1.5em;"><label><input is="emby-checkbox" type="checkbox" id="chkVideoFormatOverlayHorizontal" data-config-key="VideoFormatOverlayHorizontal" /><span>Layout Horizontally</span></label></div>
                            </div>
                            <div>
                                <select is="emby-select" id="selVideoCodecIconAlignment" label="Video Codec Icon Alignment" data-config-key="VideoCodecIconAlignment"><option value="TopLeft">Top Left</option><option value="TopRight">Top Right</option><option value="BottomLeft">Bottom Left</option><option value="BottomRight">Bottom Right</option></select>
                                <div class="checkboxContainer" style="margin-top: 1.5em;"><label><input is="emby-checkbox" type="checkbox" id="chkVideoCodecOverlayHorizontal" data-config-key="VideoCodecOverlayHorizontal" /><span>Layout Horizontally</span></label></div>
                            </div>
                            <div>
                                <select is="emby-select" id="selTagIconAlignment" label="Tag Icon Alignment" data-config-key="TagIconAlignment"><option value="TopLeft">Top Left</option><option value="TopRight">Top Right</option><option value="BottomLeft">Bottom Left</option><option value="BottomRight">Bottom Right</option></select>
                                <div class="checkboxContainer" style="margin-top: 1.5em;"><label><input is="emby-checkbox" type="checkbox" id="chkTagOverlayHorizontal" data-config-key="TagOverlayHorizontal" /><span>Layout Horizontally</span></label></div>
                            </div>
                            <div>
                                <select is="emby-select" id="selResolutionIconAlignment" label="Resolution Icon Alignment" data-config-key="ResolutionIconAlignment"><option value="TopLeft">Top Left</option><option value="TopRight">Top Right</option><option value="BottomLeft">Bottom Left</option><option value="BottomRight">Bottom Right</option></select>
                                <div class="checkboxContainer" style="margin-top: 1.5em;"><label><input is="emby-checkbox" type="checkbox" id="chkResolutionOverlayHorizontal" data-config-key="ResolutionOverlayHorizontal" /><span>Layout Horizontally</span></label></div>
                            </div>
                            <div>
                                <select is="emby-select" id="selCommunityScoreIconAlignment" label="Rating Icon Alignment" data-config-key="CommunityScoreIconAlignment"><option value="TopLeft">Top Left</option><option value="TopRight">Top Right</option><option value="BottomLeft">Bottom Left</option><option value="BottomRight">Bottom Right</option></select>
                                <div class="checkboxContainer" style="margin-top: 1.5em;"><label><input is="emby-checkbox" type="checkbox" id="chkCommunityScoreOverlayHorizontal" data-config-key="CommunityScoreOverlayHorizontal" /><span>Layout Horizontally</span></label></div>
                            </div>
                            <div>
                                <select is="emby-select" id="selAspectRatioIconAlignment" label="Aspect Ratio Icon Alignment" data-config-key="AspectRatioIconAlignment"><option value="TopLeft">Top Left</option><option value="TopRight">Top Right</option><option value="BottomLeft">Bottom Left</option><option value="BottomRight">Bottom Right</option></select>
                                <div class="checkboxContainer" style="margin-top: 1.5em;"><label><input is="emby-checkbox" type="checkbox" id="chkAspectRatioOverlayHorizontal" data-config-key="AspectRatioOverlayHorizontal" /><span>Layout Horizontally</span></label></div>
                            </div>
                            <div>
                                <select is="emby-select" id="selCommunityScoreBackgroundShape" label="Rating Background Shape" data-config-key="CommunityScoreBackgroundShape">
                                    <option value="None">None</option>
                                    <option value="Circle">Circle</option>
                                    <option value="Square">Square</option>
                                </select>
                                <div style="margin-top: 1.5em;">
                                    <label class="inputLabel" for="txtCommunityScoreBackgroundColor">Background Color</label>
                                    <input type="color" id="txtCommunityScoreBackgroundColor" data-config-key="CommunityScoreBackgroundColor" style="width: 100%; height: 2.5em; padding: 0.2em; background: transparent; border: 1px solid rgb(85, 85, 85); border-radius: 4px; box-sizing: border-box;">
                                </div>
                                <div style="margin-top: 1.5em;">
                                    <label class="inputLabel" for="rngCommunityScoreBackgroundOpacity">Background Opacity: <span id="valCommunityScoreBackgroundOpacity"></span></label>
                                    <input type="range" min="0" max="100" step="1" id="rngCommunityScoreBackgroundOpacity" data-config-key="CommunityScoreBackgroundOpacity" class="slider" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 3em; margin-bottom: 2em;">
                        <img class="previewImage" alt="Loading Preview..." style="max-height: 24em; display: block; background-color: #101010; margin: auto;" />
                    </div>

                    <div class="flex align-items-center" style="margin: 3em 0 .5em;">
                        <h2 style="margin: 0;">Advanced Settings</h2>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1em 2em;">
                        <div class="inputContainer">
                            <input is="emby-input" type="number" id="txtIconSize" label="Icon Size (% of poster height):" min="1" max="100" data-config-key="IconSize" />
                        </div>
                        <div class="inputContainer">
                            <input is="emby-input" type="number" id="txtJpegQuality" label="Image Quality (10-100):" min="10" max="100" data-config-key="JpegQuality" />
                        </div>
                        <div class="checkboxContainer" style="grid-column: 1 / -1;">
                            <label>
                                <input is="emby-checkbox" type="checkbox" id="chkEnableImageSmoothing" data-config-key="EnableImageSmoothing" />
                                <span>Enable image smoothing (improves icon quality on scaled images)</span>
                            </label>
                        </div>
                        <div class="checkboxContainer" style="grid-column: 1 / -1;">
                            <label>
                                <input is="emby-checkbox" type="checkbox" id="chkEnableDebugLogging" data-config-key="EnableDebugLogging" />
                                <span>Enable detailed debug logging</span>
                            </label>
                            <div class="fieldDescription">Enable this to log detailed information to the Emby server log. Useful for troubleshooting.</div>
                        </div>
                    </div>

                    <div style="margin-top: 2em;">
                        <button is="emby-button" type="submit" class="raised button-submit block">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
            </div>

            <div id="readmePage" class="hide" style="margin-top: 2em;">
                <div style="max-width: 800px; margin: auto;">
                    <h1 style="margin-bottom: 1em;">EmbyIcons Plugin Guide</h1>

                    <h3>Introduction</h3>
                    <p>This plugin overlays icons for language, audio channels, video format, resolution, and community ratings onto your media posters. To work correctly, you must provide your own icon images in a designated folder and name them according to the conventions below.</p>
                    <p>Supported image formats for icons are <code>.png</code>, <code>.jpg</code>, <code>.webp</code>, etc.</p>

                    <h3 style="margin-top: 2em;">Icon Naming Conventions</h3>
                    <p>Icons are identified using a strict prefix-based naming scheme: <code>prefix.name.png</code>. The prefix tells the plugin what type of icon it is, and the name is matched against media properties. Any files that do not follow this convention will be ignored.</p>

                    <h4 style="margin-top: 2em;">Language & Subtitle Icons</h4>
                    <p>
                        <strong>Audio Language (prefix: lang):</strong> <code>lang.{name}.png</code><br />
                        The <code>{name}</code> should be the full language name (e.g., 'english', 'french') in lowercase, matching what Emby displays.<br />
                        <em>Example:</em> <code>lang.english.png</code>, <code>lang.french.png</code>
                    </p>

                    <p>
                        <strong>Subtitle Language (prefix: sub):</strong> <code>sub.{name}.png</code><br />
                        The <code>{name}</code> should be the full language name (e.g., 'english', 'japanese') in lowercase.<br />
                        <em>Example:</em> <code>sub.english.png</code>, <code>sub.japanese.png</code>
                    </p>

                    <h4 style="margin-top: 2em;">Dynamic Detection</h4>
                    <p>For most categories, the plugin dynamically detects properties directly from your media's metadata. This means you can create icons for any codec or audio layout that Emby recognizes, even if it's new.</p>

                    <p>
                        <strong>Audio Codec (prefix: ac):</strong> <code>ac.{codec_name}.png</code><br />
                        The <code>{codec_name}</code> should match the codec reported by Emby (e.g., 'eac3', 'dts-hd ma').<br />
                        <em>Example:</em> <code>ac.eac3.png</code>, <code>ac.dts-hdma.png</code>
                    </p>

                    <p>
                        <strong>Video Codec (prefix: vc):</strong> <code>vc.{codec_name}.png</code><br />
                        The <code>{codec_name}</code> should match the codec reported by Emby (e.g., 'hevc').<br />
                        <em>Example:</em> <code>vc.hevc.png</code>, <code>vc.av1.png</code>
                    </p>

                    <p>
                        <strong>Audio Channels (prefix: ch):</strong> <code>ch.{layout_name}.png</code><br />
                        The <code>{layout_name}</code> should match the audio layout reported by Emby (e.g., '5.1', '7.1').<br />
                        <em>Example:</em> <code>ch.5.1.png</code>, <code>ch.7.1.png</code>, <code>ch.stereo.png</code>
                    </p>

                    <p>
                        <strong>Resolution (prefix: res):</strong> <code>res.{resolution_name}.png</code><br />
                        The plugin searches the video title for the <code>{resolution_name}</code> from your filename.<br />
                        <em>Example:</em> <code>res.4k.png</code>, <code>res.1080p.png</code>, <code>res.1080i.png</code>
                    </p>

                    <p>
                        <strong>Aspect Ratio (prefix: ar):</strong> <code>ar.{ratio}.png</code><br />
                        The <code>{ratio}</code> should match the aspect ratio reported by Emby, with the colon replaced by an 'x' (e.g., '16x9', '4x3').<br />
                        <em>Example:</em> <code>ar.16x9.png</code>, <code>ar.4x3.png</code>
                    </p>

                    <p>
                        <strong>Video Format (prefix: hdr):</strong> <code>hdr.{format_name}.png</code><br />
                        This detection uses a mix of metadata and filename scanning for reliability. Supported names are `hdr`, `dv` (for Dolby Vision), and `hdr10plus`. For HDR10+, ensure the text 'hdr10plus' is in the movie's filename.<br />
                        <em>Example:</em> <code>hdr.dv.png</code>, <code>hdr.hdr.png</code>
                    </p>

                    <h4 style="margin-top: 2em;">Other Categories</h4>

                    <p>
                        <strong>Custom Tags (prefix: tag):</strong> <code>tag.{name}.png</code><br />
                        Matches against media tags on an item (case-insensitive). The live preview uses a built-in icon.<br />
                        <em>Example:</em> For a media item tagged '3D', name the icon <code>tag.3d.png</code>.
                    </p>

                    <p>
                        <strong>Community Rating (prefix: rating):</strong> <code>rating.{name}.png</code><br />
                        Displayed next to the community score.<br />
                        <em>Example:</em> <code>rating.imdb.png</code>
                    </p>

                    <div style="margin-top: 3em; padding: 1em; background-color: rgba(255, 235, 59, 0.1); border-left: 4px solid #ffeb3b; border-radius: 4px;">
                        <div style="display: flex; align-items: center; gap: 1em;">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24" width="24" fill="#ffeb3b" style="flex-shrink: 0;">
                                <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"></path>
                            </svg>
                            <div>
                                <p style="margin: 0 0 0.5em 0; font-weight: 500;">Thank you to all supporters and people that helped testing this, specially Neminem from the Emby forum.</p>
                                <p style="margin: 0;">If you like this project and would like to support it then you can <a href="https://buymeacoffee.com/yockser" target="_blank" rel="noopener noreferrer">donate me a coffee</a>, remember to write your name and i will add it here!</p>
                                <p style="margin: 0 0 0.5em 0; font-weight: 500;">Thank you for the donations to:</p>
                                <p style="margin: 0 0 0.5em 0; font-weight: 500;">Alexander Hürter.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>